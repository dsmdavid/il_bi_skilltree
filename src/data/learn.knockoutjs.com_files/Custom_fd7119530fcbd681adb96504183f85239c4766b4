window.liveLearn=window.liveLearn||{};window.liveLearn.version=2;window.liveLearn.analytics={trackEvent:function(d,a,b){if(typeof a!="string"||!a)return;if(typeof b!="number")return;var c="/ajax/"+d+"/"+a+"/"+b;window._gaq&&window._gaq.push(["_trackPageview",c])},trackTutorialNavigation:function(a,b){window.liveLearn.analytics.trackEvent("nav",a,b)},trackFixMyCode:function(a,b){window.liveLearn.analytics.trackEvent("fixMyCode",a,b)}};window.liveLearn.codeEditorViewModel=function(b,a){this.mode=b;this.content=ko.observable();this.hasFocusOrMouseOver=ko.observable(false);this.onKeyEvent=a;this.updateContentFromUiFunction=ko.observable();this.replaceContent=function(a){this.updateContentFromUiFunction()();this.content(a)}};window.liveLearn.codeRunnerViewModel=function(b,c,e,d){var a=this;this.runnablePageUrl=ko.observable();this.runnablePageUrl.equalityComparer=function(){return false};this.canRunCode=ko.observable(true);this.showSpinner=ko.observable(false);this.urlToDisplay=ko.observable("");this.refresh=function(g,j,h){this.showSpinner(true);var f=e.replace("{{headtags}}",g&&g.HeadTags||"").replace("{{html}}",j).replace("{{javascript}}",h);if(d()){var i="data:text/html;charset=utf-8,"+encodeURIComponent(f);a.runnablePageUrl(i);setTimeout(function(){a.showSpinner(false)},300)}else $.post(b,{htmlPage:f},function(b){a.runnablePageUrl(c+"?id="+b);setTimeout(function(){a.showSpinner(false)},300)})}};window.liveLearn.splitterViewModel=function(a){this.positionPercent=ko.observable(a);this.isDragging=ko.observable(false)};window.liveLearn.overlayViewModel=function(){this.isVisible=ko.observable(false);this.close=function(){this.isVisible(false)}};window.liveLearn.firstRunOverlayViewModel=function(a){window.liveLearn.overlayViewModel.call(this);this.close=function(){this.isVisible(false);!a.currentTutorialSlug()&&a.currentTutorialSlug("intro")}.bind(this)};window.liveLearn.tutorialPickerViewModel=function(a,b){window.liveLearn.overlayViewModel.call(this);this.tutorialInfos=b;this.selectTutorial=function(b){a.currentTutorialSlug(b);this.isVisible(false)};this.selectedTutorialSlug=ko.dependentObservable(function(){return a.currentTutorialSlug()},this)};window.liveLearn.yesNoChoiceOverlayViewModel=function(){window.liveLearn.overlayViewModel.call(this);var a={},c=this;this.show=function(b){this.isVisible(true);a=b||{}};function b(b){b&&b();c.close();a.afterClose&&a.afterClose()}this.closeYes=function(){b(a.onYes)};this.closeNo=function(){b(a.onNo)}};window.liveLearn.appViewModel=function(b){var a=this;this.tutorialInfos=b.tutorialInfos;this.currentTutorialSlug=ko.observable();this.currentTutorialStepIndex=ko.observable(undefined);this.currentTutorial=ko.observable();this.currentTutorialSlug.subscribe(function(c){a.currentTutorial()&&d();if(c)$.post(b.tutorialDataUrl,{slug:c},function(b){if(b.movedPermanently){a.currentTutorialSlug(b.movedPermanently);return}a.currentTutorialStepIndex(undefined);a.currentTutorial(b);a.htmlPaneViewModel.replaceContent(b.InitialView);a.jsPaneViewModel.replaceContent(b.InitialViewModel);var d=i(c);if(d)a.reloadOrResetOverlay.show({onYes:function(){h(d)},onNo:function(){a.currentTutorialStepIndex(0)},afterClose:function(){a.runCode()}});else{a.currentTutorialStepIndex(0);a.runCode()}});else{a.currentTutorialStepIndex(0);a.currentTutorial(null)}});this.currentTutorialStep=ko.dependentObservable(function(){return!this.currentTutorial()?null:this.currentTutorialStepIndex()===undefined?null:this.currentTutorialStepIndex()>=this.currentTutorial().Steps.length?null:this.currentTutorial().Steps[this.currentTutorialStepIndex()]},this);this.canMoveBack=ko.dependentObservable(function(){return this.currentTutorialStepIndex()>0},this);this.canMoveNext=ko.dependentObservable(function(){return this.currentTutorial()&&this.currentTutorialStepIndex()<this.currentTutorial().Steps.length-1},this);function e(c){if(a.currentTutorialStepIndex()===undefined)return;var b=a.currentTutorialStepIndex()+c;if(b>=0&&b<a.currentTutorial().Steps.length){a.currentTutorialStepIndex(b);a.tutorialScrollPos(0)}}this.moveNext=function(){e(1)};this.moveBack=function(){e(-1)};this.showHelp=function(){a.firstRunOverlay.isVisible(true)};this.processPossibleShortcutKeys=function(b){if((b.ctrlKey||b.metaKey)&&!b.altKey)if(b.keyCode==13){(b.type=="keydown"||b.type=="keyup")&&a.runCode();b.stop&&b.stop();return true}};this.htmlPaneViewModel=new window.liveLearn.codeEditorViewModel("htmlmixed",this.processPossibleShortcutKeys);this.jsPaneViewModel=new window.liveLearn.codeEditorViewModel("javascript",this.processPossibleShortcutKeys);var f=ko.dependentObservable(function(){var b=!!navigator.userAgent.match(/Trident\/\d\./);return $.browser.msie||b?false:!(a.currentTutorial()&&a.currentTutorial().NoDataUrls)});this.codeRunnerViewModel=new window.liveLearn.codeRunnerViewModel(b.createRunnablePageUrl,b.fetchRunnablePageUrl,b.codeRunnerTemplate,f);this.centralSplitterViewModel=new window.liveLearn.splitterViewModel(44);this.leftColumnSplitterViewModel=new window.liveLearn.splitterViewModel(50);this.rightColumnSplitterViewModel=new window.liveLearn.splitterViewModel(40);this.tutorialPicker=new window.liveLearn.tutorialPickerViewModel(this,this.tutorialInfos);this.reloadOrResetOverlay=new window.liveLearn.yesNoChoiceOverlayViewModel;this.fixCodeOverlay=new window.liveLearn.yesNoChoiceOverlayViewModel;this.firstRunOverlay=new window.liveLearn.firstRunOverlayViewModel(this);this.tutorialScrollPos=ko.observable(0);this.flashMessage=ko.observable("");this.shouldShowFlashMessage=ko.observable(false);this.isDragging=ko.dependentObservable(function(){return this.centralSplitterViewModel.isDragging()||this.leftColumnSplitterViewModel.isDragging()||this.rightColumnSplitterViewModel.isDragging()},this);this.isAnimating=ko.dependentObservable(function(){return this.isDragging()||this.tutorialPicker.isVisible()||this.fixCodeOverlay.isVisible()||this.reloadOrResetOverlay.isVisible()||this.firstRunOverlay.isVisible()},this);var c;function g(d,b){a.flashMessage(d);a.shouldShowFlashMessage(true);c&&clearTimeout(c);c=setTimeout(function(){a.shouldShowFlashMessage(false);b&&b()},2e3)}function i(b){var a=amplify.store("tutorialState."+b);return a&&a.siteVersion==window.liveLearn.version?a:undefined}function h(b){if(b){a.htmlPaneViewModel.replaceContent(b.html);a.jsPaneViewModel.replaceContent(b.js);a.currentTutorialStepIndex(b.currentTutorialStepIndex||0)}}function j(){var b=a.currentTutorial();if(!b)return;var d=a.htmlPaneViewModel.content()!=b.InitialView||a.jsPaneViewModel.content()!=b.InitialViewModel,c=!d?null:{siteVersion:window.liveLearn.version,html:a.htmlPaneViewModel.content(),js:a.jsPaneViewModel.content(),currentTutorialStepIndex:a.currentTutorialStepIndex()};amplify.store("tutorialState."+b.Slug,c)}function d(){a.htmlPaneViewModel.updateContentFromUiFunction()();a.jsPaneViewModel.updateContentFromUiFunction()();j()}this.runCode=function(){d();a.codeRunnerViewModel.refresh(a.currentTutorial(),a.htmlPaneViewModel.content(),a.jsPaneViewModel.content())};this.chooseTutorial=function(){this.tutorialPicker.isVisible(true)};this.fixCode=function(){this.fixCodeOverlay.show({onYes:function(){a.htmlPaneViewModel.replaceContent(a.currentTutorialStep().FinishedHtml);a.jsPaneViewModel.replaceContent(a.currentTutorialStep().FinishedJs);g("Replaced code with working version",a.runCode);window.liveLearn.analytics.trackFixMyCode(a.currentTutorialSlug(),a.currentTutorialStepIndex())}})};this.canFixCode=ko.dependentObservable(function(){return this.currentTutorialStep()&&this.currentTutorialStep().FinishedHtml&&this.currentTutorialStep().FinishedJs},this);this.handleChildIframeUrlNotification=function(b){a.codeRunnerViewModel.urlToDisplay(b)};this.currentTutorialStepIndex.subscribe(function(b){window.liveLearn.analytics.trackTutorialNavigation(a.currentTutorialSlug(),b)})};ko.bindingHandlers.markdown={update:function(c,e){var b=ko.utils.unwrapObservable(e()),a=null;if(b){a=(new Showdown.converter).makeHtml(b);if(b){var d=$.browser.msie&&$.browser.version<=7;if(d){a=a.replace(/\{\*/g,"");a=a.replace(/\*\}/g,"")}else{a=a.replace(/\{\*/g,"<span class='highlight'>");a=a.replace(/\*\}/g,"</span>")}}}ko.bindingHandlers.html.update(c,function(){return a});$("pre code",c).each(function(){hljs.highlightBlock(this,"    ")})}};ko.bindingHandlers.verticalScroll={init:function(b,c){var a;function d(){a&&clearTimeout(a);a=setTimeout(function(){a=null;Math.abs($(b).scrollTop()-c()())>=10&&c()($(b).scrollTop())},250)}$(b).scroll(d).css("overflow","auto")},update:function(b,a){var c=ko.utils.unwrapObservable(a());$(b).scrollTop(c)}};ko.bindingHandlers.fadeVisible={init:function(d,c){var a=ko.utils.unwrapObservable(c()),b=typeof a=="boolean"?a:ko.utils.unwrapObservable(a.condition);$(d).css("display",b?"block":"none").css("opacity",b?1:0)},update:function(c,d){var a=ko.utils.unwrapObservable(d()),b=typeof a=="boolean"?a:ko.utils.unwrapObservable(a.condition),e=typeof a=="boolean"?undefined:ko.utils.unwrapObservable(a.speed);$(c).stop(true,false).css("display","block").animate({opacity:b?1:0},{duration:e,complete:function(){$(c).css("display",b?"block":"none")}})}};ko.bindingHandlers.fillRemainingHeight={init:function(c,b){var d=ko.utils.unwrapObservable(b());$elem=$(c),$parent=$elem.parent(),$afterElem=$parent.children().filter(d.after);function a(){$elem.height($parent.height()-$afterElem.height())}a();$(window).resize(a)}};ko.bindingHandlers.navigateIframeTo={update:function(a,b){var d=ko.utils.unwrapObservable(b())||"about:blank",c=a.contentWindow?a.contentWindow:a.contentDocument.document?a.contentDocument.document:a.contentDocument;c.location.replace(d)}};ko.bindingHandlers.overlay={update:function(a,d,c){var b=ko.utils.unwrapObservable(d()),e=c();if(b.isVisible()&&!a.overlayVisible){$.prompt.close();a.overlayVisible=true;$.prompt(a,{opacity:.7,show:"slideDown",remove:function(){b.isVisible(false)},persistent:true,top:e.overlayTop,buttons:{}})}else if(a.overlayVisible&&!b.isVisible()){a.overlayVisible=false;$(a).hide().appendTo(document.body);$.prompt.close()}}};ko.bindingHandlers.overlayCaption={init:function(c,a){var b=ko.utils.unwrapObservable(a());$(c).addClass("overlayCaption").prependTo(b.attachTo)}};ko.bindingHandlers.codeEditor={init:function(a,e){var b=ko.utils.unwrapObservable(e()),d="Scripts/Lib/CodeMirror-1.0/";a.codeEditorIsLoaded=false;a.codeEditorContentOnLoad=null;var c={path:d+"js/",basefiles:"codemirror-basecombined.min.js",width:"100%",height:"100%",tabMode:"spaces",indentUnit:4,textWrapping:false,enterMode:"keep",onLoad:function(){a.codeEditorIsLoaded=true;a.codeEditorContentOnLoad&&a.codeEditor.setCode(a.codeEditorContentOnLoad);switch(b.mode){case"javascript":a.codeEditor.setParser("JSParser");break;case"htmlmixed":a.codeEditor.setParser("XMLParser",{useHTMLKludges:false})}a.codeEditor.grabKeys(b.onKeyEvent,function(b,a){return b==13&&(a.ctrlKey||a.metaKey)&&!a.altKey})}};switch(b.mode){case"javascript":c.stylesheet=d+"css/jscolors.css";break;case"htmlmixed":c.stylesheet=d+"css/xmlcolors.css";c.triggers={script:"JSParser",style:"CSSParser"}}a.codeEditor=new CodeMirror(a,c);b.updateContentFromUiFunction(function(){a.codeEditorIsLoaded&&b.content(a.codeEditor.getCode())});$(a).hover(function(){b.hasFocusOrMouseOver(true)},function(){b.hasFocusOrMouseOver(false)})},update:function(a,c){var d=ko.utils.unwrapObservable(c()),b=d.content()||"";if(a.codeEditorIsLoaded)a.codeEditor.getCode()!=b&&a.codeEditor.setCode(b);else a.codeEditorContentOnLoad=b}};ko.bindingHandlers.splitter={init:function(m,p){var a=ko.utils.unwrapObservable(p()),b=$(m),e=b.prev(),d=b.next(),g=b.parent(),c=a.orientation=="horizontal",j=c?parseInt(e.css("padding-bottom"))+parseInt(d.css("padding-top")):parseInt(e.css("padding-right"))+parseInt(d.css("padding-left")),f=typeof a.percentageSpaceToUse=="number"?a.percentageSpaceToUse:100,o=12;b.addClass("handle").addClass(c?"horizontal":"vertical");!c&&b.add(e).add(d).css("float","left").css("height","100%");e.css("overflow-y",a.pane1Scrolls?"auto":"hidden");d.css("overflow-y",a.pane2Scrolls?"auto":"hidden");function n(a){var b=a.children().filter(".paneBody");if(b.length!=1)return;var d=a.children().filter(".paneHeader"),c=parseInt(a.css("border-bottom-right-radius"))||0;b.height(a.height()-d.height()-c)}function l(h,s){h=Math.min(Math.max(5,h),95);a.model.positionPercent(h);if(c){var q=s||g.height(),i=f*j/q,k=f*(o-j)/q,m=h-k/2-i,t=f-m-k-i;e.css("height",m+"%");d.css("height",t+"%");b.css("height",k+"%")}else{var r=s||g.width(),i=f*j/r,l=f*(o-j)/r,p=h-l/2-i,u=f-p-l-i;e.css("width",p+"%");d.css("width",u+"%");b.css("width",l+"%")}n(e);n(d)}var h,i,k;b.draggable({axis:c?"y":"x",helper:"none",containment:"parent",start:function(){h=g.position();i={width:g.width(),height:g.height()};k=c?b.height():b.width();a.showDuringDrag&&$(a.showDuringDrag).show();a.model.isDragging(true)},stop:function(){a.showDuringDrag&&$(a.showDuringDrag).hide();a.model.isDragging(false)},drag:function(d,b){if(c){var a=100*(k/2+b.offset.top-h.top)/i.height;l(a,i.height)}else{var a=100*(k/2+b.offset.left-h.left)/i.width;l(a,h.width)}}});m.refreshPositionFromViewModel=function(){l(a.model.positionPercent())};$(window).resize(m.refreshPositionFromViewModel)},update:function(a){a.refreshPositionFromViewModel()}};var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-65756-8"]);_gaq.push(["_trackPageview"]);location.hostname!="localhost"&&(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})()